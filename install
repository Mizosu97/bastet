#!/bin/bash


echo "Updating your current install to the latest packages."
sudo -S pacman -Syu

echo "Installing a few dependencies."
sudo -S pacman -S lua feh i3-gaps i3status dmenu xclip maim alacritty steam firefox neovim neofetch


if [ -d "$HOME/.mizOS" ]; then
	echo "mizOS is already installed, skippimg base system installation."
else
	printf "\n\n\nAre you installing SystemD mizOS onto an Asus laptop? (y/n)\n\n> "
	read ans

	if [ $ans == "y" ]; then
		echo "Installing Asus laptop utilities."
		sudo -S pacman -S asusctl supergfxctl
		echo "Enabling asusctl and supergfxctl."
		printf "\n\n\n Are you using the ISO image? (y/n)"
		read ans
		if [ $ans == "y" ]; then
			echo "After installation, run miz gfx setup."
		else
			sudo -S systemctl enable --now power-profiles-daemon.service
			sudo -S systemctl enable --now supergfxd
		fi
	fi

	if [ -d "$HOME/.config" ]; then
		echo ".config already exists."
	else
		mkdir $HOME/.config
	fi

	echo "Creating $HOME/.mizOS"
	mkdir $HOME/.mizOS
fi




if [ -d "$HOME/.mizOS/config" ]; then
	echo "config folder present."
else
	echo "Creating $HOME/.mizOS/config"
	mkdir $HOME/.mizOS/config
fi


if [ -d "$HOME/.mizOS/backup" ]; then
	echo "backup folder present."
else
	echo "Creating $HOME/.mizOS/backup."
	mkdir $HOME/.mizOS/backup
fi


if [ -d "$HOME/.mizOS/wallpaper" ]; then
	echo "wallpaper folder present."
else
	echo "Creating $HOME/.mizOS/wallpaper"
	mkdir $HOME/.mizOS/wallpaper
fi


if [ -d "$HOME/.mizOS/src" ]; then
	echo "src folder present."
else
	echo "creating $HOME/.mizOS/src"
	mkdir $HOME/.mizOS/src
fi


if [ -d "$HOME/.mizOS/packages" ]; then
	echo "packages folder present."
else
	echo "Creating $HOME/.mizOS/packages"
	mkdir $HOME/.mizOS/packages
else


if [ -d "$HOME/.mizOS/work" ]; then
	echo "work folder present."
else
	echo "creating $HOME/.mizOS/work"
	mkdir $HOME/.mizOS/work
fi


if [ -d $HOME/.mizOS/init ]; then
	echo "init folder present."
else
	echo "Detecting init system."
	mkdir $HOME/.mizOS/init
	if test -f "/usr/bin/sv"; then
		echo "Runit detected"
		sudo -S touch /etc/mizOS/init/runit
	elif test -f "/usr/bin/systemctl"; then
		echo "SystemD detected"
		sudo -S touch /etc/mizOS/init/systemd
	elif test -f "/usr/bin/rc-service"; then
		echo "openRC detected"
		sudo -S touch /etc/mizOS/init/openrc
	fi
fi



echo "Replacing original neofetch file."
sudo -S rm /usr/bin/neofetch
sudo -S cp assets/neofetch /usr/bin


echo "Adding that amazing wallpaper to $HOME/.mizOS/wallpaper."
cp assets/wallpaper.png $HOME/.mizOS/wallpaper/



echo "mizOS is about to install configuration files for i3-gaps, picom, and alacritty. If you already have configuration files for these programs, they will be backed up to $HOME/.mizOS/backup."

if [ -d "$HOME/.config/i3" ]; then
	echo "Backing up current i3 configuration."
	mv $HOME/.config/i3 $HOME/.mizOS/backup
fi


if [ -d "$HOME/.config/alacritty" ]; then
	echo "Backing current alacritty configuration."
	mv $HOME/.config/alacritty $HOME/.mizOS/backup
fi


if [ test -f "$HOME/.config/picom.conf" ]; then
	echo "Backing up current picom configuration."
	mv $HOME/.config/picom.conf $HOME/.mizOS/backup
fi


echo "Installing the i3 configuration file."
mkdir $HOME/.config/i3
cp assets/i3/config $HOME/.config/i3/
cp -r assets/i3 $HOME/.mizOS/config


echo "Installing the Alacritty config file."
mkdir $HOME/.config/alacritty
mkdir $HOME/.mizOS/config/alacritty
cp assets/alacritty.yml $HOME/.config/alacritty
cp assets/alacritty.yml $HOME/.mizOS/config

echo "Installing the Picom configuration file."
cp assets/picom.conf $HOME/.config
cp assets/picom.conf $HOME/.mizOS/config


echo "Configuration files added."



echo "Installing the miz script."
chmod +x assets/miz
sudo -S cp assets/miz /usr/bin


echo "Changing your os-release file."
sudo -S rm /etc/os-release
sudo -S cp assets/os-release /etc


echo "Changing your lsb-release file."
sudo -S rm /etc/lsb-release
sudo -S cp assets/lsb-release /etc



echo "My work here is done! You should probably reboot."
echo "  "
echo "If you are currently using i3-gaps, reload with MOD+shift+c, then press MOD+shift+n then MOD+shift+m to see theming changes."
echo " "
echo "! WARNING ! PLEASE REFRAIN FROM USING sudo pacman -Syu to update, instead, PLEASE use miz update"
